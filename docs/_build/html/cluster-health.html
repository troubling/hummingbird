

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Cluster Health &mdash; Hummingbird v.PR documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/privatecloud.ico"/>
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/theme_overrides.css" type="text/css" />
  
    <link rel="stylesheet" href="_static/bespoke.css" type="text/css" />
  
    <link rel="stylesheet" href="_static/bolditalic.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Hummingbird v.PR documentation" href="index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Hummingbird
          

          
            
            <img src="_static/privatecloud.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                v.PR
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="index.html">Hummingbird</a></li>
<li class="toctree-l1"><a class="reference internal" href="arch/index.html">Hummingbird Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="admin/index.html">Hummingbird Cluster Health</a></li>
<li class="toctree-l1"><a class="reference internal" href="dev/index.html">Hummingbird Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="replication-tools.html">Hummingbird Priority Replication Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="debug-single.html">Debugging a single account, container, or object</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Hummingbird</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Cluster Health</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/cluster-health.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="cluster-health">
<h1>Cluster Health<a class="headerlink" href="#cluster-health" title="Permalink to this headline">#</a></h1>
<p>The andrewd service as well as the recon tool monitor the overall
cluster health. Andrewd is more of a background, automated process that
should be run on one server (often called the admin server) whereas the
recon tool is more interactive, often also run on the admin server since
it can read information from the andrewd database.</p>
<p>Andrewd will initially populate “dispersion objects” and containers into
the clusters within a hidden .admin account. These dispersion objects
land, one each, on all ring partitions throughout the cluster. After
these dispersion objects are in place, andrewd can check for their
presence on a recurring schedule and make note of when they are out of
place, missing replicas, etc. For example, 1 of 3 replicas being out of
place is a common occurrence as a cluster rebalances itself, but 2 of 3
or worse all 3 replicas being out of place can cause temporary errors
until rebalancing is performed. Andrewd can prioritize replication based
on this information.</p>
<div class="section" id="async-pending-report">
<h2>Async Pending Report<a class="headerlink" href="#async-pending-report" title="Permalink to this headline">#</a></h2>
<p>The Async Pending Report shows how many updates are waiting to be sent
to container servers from object servers. A burst of traffic can cause
these updates to saved to disk to be resent later when the traffic isn’t
as high. These saved requests are known as Async Pendings. An ever
increasing number of these indicate a cluster that is overwhelmed or
possible failures that need to be addressed.</p>
<p>Note that the JSON output will give counts for each server. This can be
useful in tracking down an issue. If all servers are relatively equally
backed up, this can indicate trouble with the container server layer. If
just one server has nearly all the pending requests, it is probably an
issue with that server, say, a flakey network interface or route.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ hummingbird recon -a
[2018-01-16 17:19:59] Async Pending Report
[async_pending] low: 0, high: 0, avg: 0.0, total: 0, Failed: 0.0%, no_result: 0, reported: 4
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ hummingbird recon -a -json
{
    &quot;Name&quot;: &quot;Async Pending Report&quot;,
    &quot;Time&quot;: &quot;2018-01-16T17:20:09.460534783Z&quot;,
    &quot;Pass&quot;: true,
    &quot;Servers&quot;: 4,
    &quot;Successes&quot;: 4,
    &quot;Errors&quot;: null,
    &quot;Stats&quot;: {
        &quot;127.0.0.1:6010&quot;: 0,
        &quot;127.0.0.1:6020&quot;: 0,
        &quot;127.0.0.1:6030&quot;: 0,
        &quot;127.0.0.1:6040&quot;: 0
    }
}
</pre></div>
</div>
</div>
<div class="section" id="dispersion-report">
<h2>Dispersion Report<a class="headerlink" href="#dispersion-report" title="Permalink to this headline">#</a></h2>
<p>As noted at the top of this document, andrewd will populate and monitor
dispersion objects to ensure data is reachable at all times. The recon
tool can show you the last dispersion report andrewd created, when run
on the same server as andrewd runs.</p>
<p>Note that the JSON output will give specific detail on which partitions
are missing replicas to help with any investigation.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ hummingbird recon -d
[2018-01-16 17:25:16] Dispersion Report

Container Dispersion Report at 2018-01-15 20:59:31 +0000 UTC
For container dispersion.
There were 1024 partitions missing 0 copies.
100.00% of container copies found (3072 of 3072)
Sample represents 100% of the container partition space.

Object Dispersion Report at 2018-01-15 21:01:17 +0000 UTC for Policy 0
Using storage policy 0
There were 1023 partitions missing 0 copies.
There were 1 partitions missing 1 copies.
99.97% of object copies found (3071 of 3072)
Sample represents 100% of the object partition space.

Object Dispersion Report at 2018-01-15 19:21:00 +0000 UTC for Policy 1
Using storage policy 1
There were 1024 partitions missing 0 copies.
100.00% of object copies found (2048 of 2048)
Sample represents 100% of the object partition space.
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ hummingbird recon -d -json
{
    &quot;Name&quot;: &quot;Dispersion Report&quot;,
    &quot;Time&quot;: &quot;2018-01-16T17:25:36.58866905Z&quot;,
    &quot;Pass&quot;: true,
    &quot;Errors&quot;: null,
    &quot;ContainerReport&quot;: {
        &quot;Time&quot;: &quot;2018-01-15T20:59:31Z&quot;,
        &quot;Report&quot;: &quot;For container dispersion.\nThere were 1024 partitions missing 0 copies.\n100.00% of container copies found (3072 of 3072)\nSample represents 100% of the container partition space.\n&quot;,
        &quot;Stats&quot;: null
    },
    &quot;ObjectReports&quot;: [
        {
            &quot;Time&quot;: &quot;2018-01-15T21:01:17Z&quot;,
            &quot;Policy&quot;: 0,
            &quot;Report&quot;: &quot;Using storage policy 0\nThere were 1023 partitions missing 0 copies.\nThere were 1 partitions missing 1 copies.\n99.97% of object copies found (3071 of 3072)\nSample represents 100% of the object partition space.\n&quot;,
            &quot;Stats&quot;: [
                {
                    &quot;Time&quot;: &quot;2018-01-15T21:01:17Z&quot;,
                    &quot;Partition&quot;: 689,
                    &quot;PartitionItemPath&quot;: &quot;disp-objs-0/689-44&quot;,
                    &quot;ItemsFound&quot;: 2,
                    &quot;ItemsNeed&quot;: 3
                }
            ]
        },
        {
            &quot;Time&quot;: &quot;2018-01-15T19:21:00Z&quot;,
            &quot;Policy&quot;: 1,
            &quot;Report&quot;: &quot;Using storage policy 1\nThere were 1024 partitions missing 0 copies.\n100.00% of object copies found (2048 of 2048)\nSample represents 100% of the object partition space.\n&quot;,
            &quot;Stats&quot;: null
        }
    ]
}
</pre></div>
</div>
</div>
<div class="section" id="drive-status-report">
<h2>Drive Status Report<a class="headerlink" href="#drive-status-report" title="Permalink to this headline">#</a></h2>
<p>The Drive Status Report is gathered from information recorded by
andrewd, and so this recon report needs to be run where andrewd is
running. It lists the drives that are unmounted or unreachable, usually
indicating drive or server failures that need to be corrected.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ hummingbird recon -ds
[2018-01-16 17:31:05] Drive Report
Weighted / Unmounted / Unreachable devices report for Policy 1
Last successful recon run was 0.19 hours ago.
No weighted drives are currently reported as unmounted or unreachable.
Weighted / Unmounted / Unreachable devices report for Policy 0
Last successful recon run was 0.19 hours ago.
No weighted drives are currently reported as unmounted or unreachable.
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ hummingbird recon -ds -json
{
    &quot;Name&quot;: &quot;Drive Report&quot;,
    &quot;Time&quot;: &quot;2018-01-16T17:31:09.66558933Z&quot;,
    &quot;Pass&quot;: true,
    &quot;Errors&quot;: null,
    &quot;PolicyReports&quot;: [
        {
            &quot;Policy&quot;: 0,
            &quot;Time&quot;: &quot;2018-01-16T17:19:53Z&quot;,
            &quot;SingleReports&quot;: null
        },
        {
            &quot;Policy&quot;: 1,
            &quot;Time&quot;: &quot;2018-01-16T17:19:53Z&quot;,
            &quot;SingleReports&quot;: null
        }
    ],
    &quot;MaxBadDevAge&quot;: 604800000000000
}
</pre></div>
</div>
</div>
<div class="section" id="md5-report">
<h2>MD5 Report<a class="headerlink" href="#md5-report" title="Permalink to this headline">#</a></h2>
<p>The MD5 Report verifies that all of the servers having the same ring,
the same general hummingbird.conf, and the same hummingbird executable.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ hummingbird recon -md5
[2018-01-16 17:36:21] Ring MD5 Report
4/4 hosts matched, 0 error[s] while checking hosts.
[2018-01-16 17:36:21] hummingbird.conf MD5 Report
4/4 hosts matched, 0 error[s] while checking hosts.
[2018-01-16 17:36:21] hummingbird MD5 Report
4/4 hosts matched, 0 error[s] while checking hosts.
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ hummingbird recon -md5 -json
{
    &quot;Name&quot;: &quot;Ring MD5 Report&quot;,
    &quot;Time&quot;: &quot;2018-01-16T17:36:37.703977395Z&quot;,
    &quot;Pass&quot;: true,
    &quot;Servers&quot;: 4,
    &quot;Successes&quot;: 4,
    &quot;Errors&quot;: null
}
{
    &quot;Name&quot;: &quot;hummingbird.conf MD5 Report&quot;,
    &quot;Time&quot;: &quot;2018-01-16T17:36:37.708930063Z&quot;,
    &quot;Pass&quot;: true,
    &quot;Servers&quot;: 4,
    &quot;Successes&quot;: 4,
    &quot;Errors&quot;: null
}
{
    &quot;Name&quot;: &quot;hummingbird MD5 Report&quot;,
    &quot;Time&quot;: &quot;2018-01-16T17:36:37.71483282Z&quot;,
    &quot;Pass&quot;: true,
    &quot;Servers&quot;: 4,
    &quot;Successes&quot;: 4,
    &quot;Errors&quot;: null
}
</pre></div>
</div>
</div>
<div class="section" id="quarantine-report">
<h2>Quarantine Report<a class="headerlink" href="#quarantine-report" title="Permalink to this headline">#</a></h2>
<p>Occasionally, corrupted files will be found and moved to a quarantine
area. Such corruption can occur due to hardware errors or software bugs,
though usually they indicate failing hardware. If you notice a large
increase in quarantined files, it should be investigated as soon as
possible.</p>
<p>Note that the JSON output will give specific counts for each server.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ hummingbird recon -q
[2018-01-16 17:37:22] Quarantine Report
[quarantined_account] low: 0, high: 0, avg: 0.0, total: 0, Failed: 0.0%, no_result: 0, reported: 4
[quarantined_container] low: 0, high: 1, avg: 0.2, total: 1, Failed: 0.0%, no_result: 0, reported: 4
[quarantined_objects] low: 0, high: 0, avg: 0.0, total: 0, Failed: 0.0%, no_result: 0, reported: 4
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ hummingbird recon -q -json
{
    &quot;Name&quot;: &quot;Quarantine Report&quot;,
    &quot;Time&quot;: &quot;2018-01-16T17:37:24.913043473Z&quot;,
    &quot;Pass&quot;: true,
    &quot;Servers&quot;: 4,
    &quot;Successes&quot;: 4,
    &quot;Errors&quot;: null,
    &quot;Stats&quot;: {
        &quot;Accounts&quot;: {
            &quot;127.0.0.1:6010&quot;: 0,
            &quot;127.0.0.1:6020&quot;: 0,
            &quot;127.0.0.1:6030&quot;: 0,
            &quot;127.0.0.1:6040&quot;: 0
        },
        &quot;Containers&quot;: {
            &quot;127.0.0.1:6010&quot;: 0,
            &quot;127.0.0.1:6020&quot;: 0,
            &quot;127.0.0.1:6030&quot;: 0,
            &quot;127.0.0.1:6040&quot;: 1
        },
        &quot;Objects&quot;: {
            &quot;127.0.0.1:6010&quot;: 0,
            &quot;127.0.0.1:6020&quot;: 0,
            &quot;127.0.0.1:6030&quot;: 0,
            &quot;127.0.0.1:6040&quot;: 0
        },
        &quot;Policies&quot;: {}
    }
}
</pre></div>
</div>
</div>
<div class="section" id="stalled-replicators-report">
<h2>Stalled Replicators Report<a class="headerlink" href="#stalled-replicators-report" title="Permalink to this headline">#</a></h2>
<p>The Stalled Replicators Report gives counts on how many times a
replication process (one per drive per server) had to be restarted due
to apparent inactivity. These situations can occur for various reasons,
one being that the cluster is so overloaded it cannot complete
replication tasks across the whole cluster. But, if the counts are high
just on one server, it can indicate an imminent hardware failure on that
server or drive.</p>
<p>Note that the JSON output gives specific counts for each server.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ hummingbird recon -rc
[2018-01-16 17:41:13] Stalled Replicators Report
[replication_device_cancelations] low: 0, high: 0, avg: 0.0, total: 0, Failed: 0.0%, no_result: 0, reported: 8
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ hummingbird recon -rc -json
{
    &quot;Name&quot;: &quot;Stalled Replicators Report&quot;,
    &quot;Time&quot;: &quot;2018-01-16T17:41:16.726968278Z&quot;,
    &quot;Pass&quot;: true,
    &quot;Servers&quot;: 4,
    &quot;Successes&quot;: 4,
    &quot;Errors&quot;: null,
    &quot;Warnings&quot;: null,
    &quot;Stats&quot;: {
        &quot;127.0.0.1:6010/sdb1&quot;: 0,
        &quot;127.0.0.1:6010/sdb1-1&quot;: 0,
        &quot;127.0.0.1:6020/sdb2&quot;: 0,
        &quot;127.0.0.1:6020/sdb2-1&quot;: 0,
        &quot;127.0.0.1:6030/sdb3&quot;: 0,
        &quot;127.0.0.1:6030/sdb3-1&quot;: 0,
        &quot;127.0.0.1:6040/sdb4&quot;: 0,
        &quot;127.0.0.1:6040/sdb4-1&quot;: 0
    }
}
</pre></div>
</div>
</div>
<div class="section" id="replication-partitions-per-second-report">
<h2>Replication Partitions Per Second Report<a class="headerlink" href="#replication-partitions-per-second-report" title="Permalink to this headline">#</a></h2>
<p>The Replication Partitions Per Second Report shows the speed that
replication is occurring throughout the cluster. Cluster-wide low counts
can indicate an overloaded cluster, whereas low counts on specific
servers can indicate hardware failures on those servers such as a slow
reading drive or a faulty network interface.</p>
<p>Note that the JSON output gives specific drive and server speeds whereas
the plain text report gives just the overall values.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ hummingbird recon -rp
[2018-01-16 17:58:33] Replication Partitions Per Second Report
[replication_srv_parts_per_sec] low: 59.460, high: 60.627, avg: 60.175, Failed: 0.0%, no_result: 0, reported: 4
Number drives with no partitions completed: 0
Cluster wide parts/sec: 60.171
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ hummingbird recon -rp -json
{
    &quot;Name&quot;: &quot;Replication Partitions Per Second Report&quot;,
    &quot;Time&quot;: &quot;2018-01-16T17:58:35.53897395Z&quot;,
    &quot;Pass&quot;: true,
    &quot;Servers&quot;: 4,
    &quot;Successes&quot;: 4,
    &quot;Errors&quot;: null,
    &quot;Warnings&quot;: null,
    &quot;Stats&quot;: {
        &quot;127.0.0.1:6010&quot;: 67.42422752621235,
        &quot;127.0.0.1:6020&quot;: 66.88050956069733,
        &quot;127.0.0.1:6030&quot;: 59.460068432757204,
        &quot;127.0.0.1:6040&quot;: 67.55173310057371
    },
    &quot;DriveSpeeds&quot;: {
        &quot;127.0.0.1:6010/sdb1&quot;: 73.92206417606499,
        &quot;127.0.0.1:6010/sdb1-1&quot;: 67.17052419992405,
        &quot;127.0.0.1:6020/sdb2&quot;: 77.25698292390624,
        &quot;127.0.0.1:6020/sdb2-1&quot;: 66.72298074078145,
        &quot;127.0.0.1:6030/sdb3&quot;: 55.19717872902748,
        &quot;127.0.0.1:6030/sdb3-1&quot;: 67.2507531089707,
        &quot;127.0.0.1:6040/sdb4&quot;: 77.77384551774584,
        &quot;127.0.0.1:6040/sdb4-1&quot;: 67.34428040540625
    },
    &quot;OverallAverage&quot;: 63.54168655592484,
    &quot;TotalDriveZero&quot;: 0
}
</pre></div>
</div>
</div>
<div class="section" id="replication-duration-report">
<h2>Replication Duration Report<a class="headerlink" href="#replication-duration-report" title="Permalink to this headline">#</a></h2>
<p>The Replication Duration Report gives the average amount of time it
takes to run a replication pass of each drive. The JSON output will give
averages for each server whereas the plain text report just gives the
overall average. If this duration starts dramatically increasing it can
indicate an overloaded cluster. For a normal cluster, twice the high
value should be used for the min-part-hours of the rings.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ hummingbird recon -rd
[2018-01-16 17:47:33] Replication Duration Report
[replication_duration_secs] low: 10.606, high: 10.850, avg: 10.746, Failed: 0.0%, no_result: 0, reported: 4
Number of drives not completed a pass: 0
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ hummingbird recon -rd -json
{
    &quot;Name&quot;: &quot;Replication Duration Report&quot;,
    &quot;Time&quot;: &quot;2018-01-16T17:47:35.645741121Z&quot;,
    &quot;Pass&quot;: true,
    &quot;Servers&quot;: 4,
    &quot;Successes&quot;: 4,
    &quot;Errors&quot;: null,
    &quot;Stats&quot;: {
        &quot;127.0.0.1:6010&quot;: 10.784847003,
        &quot;127.0.0.1:6020&quot;: 10.742181572,
        &quot;127.0.0.1:6030&quot;: 10.6057160435,
        &quot;127.0.0.1:6040&quot;: 10.849519436
    },
    &quot;TotalDriveZero&quot;: 0
}
</pre></div>
</div>
</div>
<div class="section" id="time-sync-report">
<h2>Time Sync Report<a class="headerlink" href="#time-sync-report" title="Permalink to this headline">#</a></h2>
<p>The Time Sync Report ensures that all the servers have relatively close
time values. If the server times drift quite far from each other, it
will cause “odd” intermittent write errors where some servers accept a
write as newer and some feel the write is too old. Server times should
be corrected immediately and a time sync service like ntp installed.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ hummingbird recon -time
[2018-01-16 18:00:13] Time Sync Report
4/4 hosts matched, 0 error[s] while checking hosts.
</pre></div>
</div>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ hummingbird recon -time -json
{
    &quot;Name&quot;: &quot;Time Sync Report&quot;,
    &quot;Time&quot;: &quot;2018-01-16T18:00:17.428365173Z&quot;,
    &quot;Pass&quot;: true,
    &quot;Servers&quot;: 4,
    &quot;Successes&quot;: 4,
    &quot;Errors&quot;: null
}
</pre></div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Rackspace.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'v.PR',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>